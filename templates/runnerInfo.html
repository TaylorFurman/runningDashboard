<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
crossorigin=""/>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
crossorigin=""></script>

<script src="../Polyline.encoded.js"></script>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>


<link rel="stylesheet" href="./styles.css">
<script src="require.js"></script>
<script src="index.js"></script>






<!--Start of the HTML Body-->
<title>Your Info</title>
<style>
    #runData {width: 40%; height: 30%;}
</style>
</head>
<body>
<h1>New Page</h1>
<div id="runData">

<label for="date">Select a running date</label>
<!--  



-->
<select name="date" id="run_date" onchange="selectChange()"><option value="">--Select--</option></select>



<div id="mapid"></div>



<!--Start of the Javascript-->
<script src=".\runningDashboard\app.js"></script>
<script src="../run_history.json"></script>

<canvas id="chart" width="300" height="300"></canvas>

<script>

//2D GIS map below
var map = L.map('mapid').setView([29.7858, -95.7700], 13);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

function selectChange(){
    var select = document.getElementById('run_date').value 
    //console.log(select);
    if (select == select){
        
        axios.get('run_history.json').then(res=>{
            for(i=0; i<data.length; i++){
                let run_data = new Map();
                run_data.set("id", res.data[i].id)
                run_data.set("Distance", res.data[i].distance);
                run_data.set("Type", res.data[i].type);
                run_data.set("Start_Date", res.data[i].start_date);
                run_data.set("Average_Speed", res.data[i].average_speed);
                run_data.set("Average_Heart_Rate", res.data[i].average_heart_rate);
                run_data.set("Moving_Time", res.data[i].moving_time);
                run_data.set("start_latlng", res.data[i].start_latlng);
                run_data.set("end_latlng", res.data[i].end_latlng);
                run_data.set("run_id", res.data[i].run_id);
                run_data.set("summary_polyline", res.data[i].summary_polyline);

                let data_id = run_data.get("id")
                let run_distance = run_data.get("Distance")
                let start_date = run_data.get("Start_Date")
                let start_latlng = run_data.get("start_latlng")
                let end_latlng = run_data.get("end_latlng")
                let summary_polyline = run_data.get("summary_polyline")


                if (select == start_date){
                   //L.polyline(remove());
                    console.log(run_distance)
                    var startLat = start_latlng.substring(0,9);
                    var startLon = start_latlng.substring(10,20);
                    var endLat = end_latlng.substring(0,9);
                    var endLon = end_latlng.substring(10,20);
                    console.log(endLat);
                    console.log(end_latlng);
                     var startIcon = L.icon({
                         iconUrl: "https://cdn.pixabay.com/photo/2013/07/13/10/29/icon-157354_1280.png",                     
                         iconSize: [38, 95],
                         iconAnchor: [22, 94],
                         popupAnchor: [-3, -76],
                         //shadowUrl: 'my-icon-shadow.png',
                         //shadowSize: [68, 95],
                         //shadowAnchor: [22, 94]
                     });
                     var endIcon = L.icon({
                         iconUrl: "https://cdn.pixabay.com/photo/2016/08/30/13/18/pin-1630707_1280.png",                     
                         iconSize: [38, 95],
                         iconAnchor: [22, 94],
                         popupAnchor: [-3, -76],
                         //shadowUrl: 'my-icon-shadow.png',
                         //shadowSize: [68, 95],
                         //shadowAnchor: [22, 94]
                     });


                    var coordinates = L.Polyline.fromEncoded(summary_polyline).getLatLngs()
                    L.marker([startLat, startLon],{icon: startIcon}).addTo(map)
                    L.marker([endLat, endLon],{icon: endIcon}).addTo(map)
                    L.polyline(
                    coordinates,
                    {
                        color:"blue",
                        weight: 5,
                        opacity: .7,
                        lineJoin: 'round'
                    }
                ).addTo(map)
                
                }               
            }    
        })
    }
}
axios.get('run_history.json')
.then(res=> {
    data = res.data;
        for(i=0; i<data.length; i++){
        var data_dropDown = data[i].start_date;
        //add all data to dropdown menu
        $(function(){
            $.each(data, function(i, item){               
                $("#run_date").append("<option value = "+ data[i].start_date+">" + data[i].start_date +"</option>");
                //$("#run_date").append("<option value =" + data_dropDown+">" + data_dropDown +"</option>");

                })
            })         
        //add all data to map 
        var coordinates = L.Polyline.fromEncoded(data[i].summary_polyline).getLatLngs()
        L.polyline(
            coordinates,
            {
                color:"green",
                weight: 5,
                opacity: .7,
                lineJoin: 'round'
            }
        )
        .addTo(map)     
    }
    
    }
) 




//chart below
var theChart = document.getElementById('chart').getContext('2d');
var theRunData = new Chart(theChart, {
type: 'bar',
data: {
    datasets: [{
        label: 'Run Distance in Kilometers',
        data: [
            6.4,
            5.2,
            5.1,
            5.1,
            2.3,
            10.1,
            1.9,
            6.9,
            5.1,
            2.1,
            3.6,
            5.1,
            8.4,
            8.1,
            3.2,
            4.9,
            6.4,
            3.2,
            5.5,
            5.03,
            6.4,
            3.2,
            5.06,
            3.2,
            11.3
        ],
        borderColor: ['rgb(255,99,132)'],
        backgroundColor: ['rgb(255, 99, 132, 0.2)']
    }, {
        label: 'Average Heart Rate',
        data: [
            160.4,
            162.9,
            162.9,
            161.6,
            160.2,
            155.5,
            155.5,
            169.7,
            158,
            158.2,
            161.3,
            151,
            165.2,
            164,
            163,
            151.3,
            146.6,
            159,
            165.1,
            160.4,
            167,
            162.8,
            162.9,
            151.2,
            151.7,
            156
        ],
        borderColor: 'rgb(54, 162, 235)', 
        type: 'line',
    }, {
        label: 'Average Speed',
        data: [
            2.6,
            2.4,
            2.6,
            2.5,
            2.6,
            2.6,
            2.4,
            2.7,
            2.5,
            2.5,
            2.7,
            2.7,
            2.6,
            2.3,
            2.7,
            2.5,
            2.7,
            2.6,
            2.6,
            2.6,
            2.6,
            2.6,
            2.5,
            2.7,
            2.7,
            2.1
        ],
        borderColor: 'rgb(54, 162, 145)',
        type: 'line',
    }],
    labels: ['2021-07-08', '2021-07-05', '2021-07-04', '2021-06-26', '2021-06-25', '2021-06-25', '2021-06-19', '2021-06-16', '2021-06-15', '2021-06-13', '2021-06-07', '2021-05-26', '2021-05-24', '2021-05-23', '2021-05-12', '2021-05-10', '2021-05-06', '2021-05-05', '2021-05-04', '2021-05-03', '2021-04-14', '2021-04-10', '2021-04-08', '2021-03-31', '2021-03-29']
},
options: {
    scales: {
        y: {
            beginAtZero: true
        }
    }}
    
});







                </script>
                </div>
</body>
</html>
